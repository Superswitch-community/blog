<!DOCTYPE html>
<html>
<head>
  <title>Posts</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">

<h1 class="text-3xl font-bold mb-6 text-center">All Pages</h1>

<div id="pageContainer"></div>

<div class="flex justify-center gap-6 mt-8">
  <button id="prevBtn" class="bg-gray-600 text-white px-6 py-2 rounded">◀ Prev</button>
  <button id="nextBtn" class="bg-blue-600 text-white px-6 py-2 rounded">Next ▶</button>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyD-_RmLITahJNeHrA84wxXeWEDj8vYLJNg",
  authDomain: "blog-database-b95f7.firebaseapp.com",
  projectId: "blog-database-b95f7",
  storageBucket: "blog-database-b95f7.firebasestorage.app",
  messagingSenderId: "730060757439",
  appId: "1:730060757439:web:264a88711bb4215866a90a",
  measurementId: "G-EX3TPSYK4B"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const container = document.getElementById("pageContainer");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");

let pages = [];
let currentIndex = 0;

async function loadPages() {
  const snapshot = await getDocs(collection(db, "pages"));
  pages = snapshot.docs;
  if (pages.length > 0) renderPage();
}

async function renderPage() {
  const pageDoc = pages[currentIndex];
  container.innerHTML = "";

  const pageDiv = document.createElement("div");
  pageDiv.className = "bg-white p-6 rounded shadow";

  pageDiv.innerHTML = `
    <h2 class="text-2xl font-bold mb-6 text-center">${pageDoc.data().name}</h2>
    <div id="posts" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
  `;

  container.appendChild(pageDiv);

  const postsContainer = document.getElementById("posts");
  const postsSnapshot = await getDocs(collection(db, "pages", pageDoc.id, "posts"));

  postsSnapshot.forEach(doc => {
    const post = doc.data();
    postsContainer.innerHTML += `
      <div class="bg-gray-50 p-4 rounded shadow">
        <img src="${post.image}" class="w-full h-40 object-cover rounded mb-3"/>
        <p class="font-semibold">ID: ${post.customId}</p>
        <p>${post.description}</p>
      </div>
    `;
  });
}

nextBtn.addEventListener("click", () => {
  currentIndex++;
  if (currentIndex >= pages.length) currentIndex = 0; // loop
  renderPage();
});

prevBtn.addEventListener("click", () => {
  currentIndex--;
  if (currentIndex < 0) currentIndex = pages.length - 1; // loop
  renderPage();
});

loadPages();

</script>
</body>
</html>
